<?php
include('../includes/inicio_sesion.php');
include('../mysql/conectar.php');
echo "<meta http-equiv='Content-type' content='text/html; charset=utf-8' />";

$id_colegio = $_SESSION['colegio'];
        //Aquí es donde seleccionamos nuestro csv
         $fname = $_FILES['sel_file']['name'];
         echo 'Cargando nombre del archivo: '.$fname.' <br>';
         $chk_ext = explode(".",$fname);
 
         if(strtolower(end($chk_ext)) == "csv")
         {
             //si es correcto, entonces damos permisos de lectura para subir
             $filename = $_FILES['sel_file']['tmp_name'];
             $handle = fopen($filename, "r");
             $count = 0;

             while (($data = fgetcsv($handle, 1000, ",","\"")) !== FALSE)
             {


                if ($count >= 1) {/*para que empiece a importar datos desde la segunda linea, ya que la primera es el titulo de cada columna*/
                    $sql = "INSERT INTO COMODATARIOS (DNI_COM, TIPO_COM, APEYNOM, DNI_ADULTO, APEYNOM_A, MARCA, MODELO, SERIE, ID_COLEGIO_FK) VALUES('$data[0]','$data[1]','$data[2]','$data[3]','$data[4]','$data[5]','$data[6]','$data[7]','$id_colegio')";
                mysqli_query($conexion, $sql) or die('Error: '.mysqli_error($conexion));

                }
               //Insertamos los datos con los valores...
                $count++;
             }
             //cerramos la lectura del archivo "abrir archivo" con un "cerrar archivo"
             fclose($handle);
             echo "Importación exitosa!";
         }
         else
         {
            //si aparece esto es posible que el archivo no tenga el formato adecuado, inclusive cuando es csv, revisarlo para             
//ver si esta separado por " , "
             echo "Archivo invalido!";
         }

 
?>